{"version":3,"sources":["helpers.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["emitEvent","socket","eventName","a","args","Promise","resolve","emit","data","App","useState","isInRoom","setInRoom","isLoading","setLoading","lastError","setLastError","usernameInput","setUsernameInput","roomNameInput","setRoomNameInput","isAutoReady","setAutoReady","isCopyToClipboard","setCopyToClipboard","roomName","setRoomName","clipboard","membersState","roomState","setRoomState","clientUser","setClientUser","connection","setConnection","isInRoomRef","useRef","isLoadingRef","isAutoReadyRef","isCopyToClipboardRef","clientUserRef","connectionRef","roomStateRef","current","onToggleReady","Error","result","status","failMessage","disconnect","useEffect","lastClipboardEntry","repeat","clipboardInterval","setInterval","clipboardEntry","navigator","writeText","clearInterval","htmlFor","type","name","value","onChange","e","target","disabled","onClick","username","trim","io","reconnection","reconnectionDelay","reconnectionAttempts","autoConnect","on","console","log","auth","reason","find","roomUser","isReady","sessionId","connect","map","style","width","height","checked","index","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.4a402df9.chunk.js","sourcesContent":["import { Socket } from \"socket.io-client\";\nimport { FailedResult } from \"./Interfaces/FailResult\";\nimport { SuccessResult } from \"./Interfaces/SuccessResult\";\n\nexport const emitEvent = async <T>(\n  socket: Socket,\n  eventName: string,\n  ...args: unknown[]\n): Promise<FailedResult | SuccessResult<T>> => {\n  return new Promise((resolve) => {\n    socket.emit(eventName, ...args, (data: FailedResult | SuccessResult<T>) => {\n      resolve(data);\n    });\n  });\n};\n","import React, { useEffect, useRef, useState } from \"react\";\nimport { io, Socket } from \"socket.io-client\";\nimport \"./App.css\";\nimport { emitEvent } from \"./helpers\";\nimport { RoomState } from \"./Interfaces/RoomState\";\nimport { RoomUser } from \"./Interfaces/RoomUser\";\n\nexport const App = (): JSX.Element => {\n  const [isInRoom, setInRoom] = useState(false);\n  const [isLoading, setLoading] = useState(false);\n  const [lastError, setLastError] = useState(\"\");\n  const [usernameInput, setUsernameInput] = useState(\"\");\n  const [roomNameInput, setRoomNameInput] = useState(\"\");\n  const [isAutoReady, setAutoReady] = useState(false);\n  const [isCopyToClipboard, setCopyToClipboard] = useState(false);\n\n  const [roomName, setRoomName] = useState(\"\");\n  const [roomState, setRoomState] = useState<RoomState>({\n    clipboard: [],\n    membersState: [],\n  });\n  const [clientUser, setClientUser] = useState<RoomUser | null>(null);\n  const [connection, setConnection] = useState<Socket | null>(null);\n\n  const isInRoomRef = useRef<boolean>();\n  const isLoadingRef = useRef<boolean>();\n  const isAutoReadyRef = useRef<boolean>();\n  const isCopyToClipboardRef = useRef<boolean>();\n\n  const clientUserRef = useRef<RoomUser | null>();\n  const connectionRef = useRef<Socket | null>();\n  const roomStateRef = useRef<RoomState>();\n  isInRoomRef.current = isInRoom;\n  isLoadingRef.current = isLoading;\n  isAutoReadyRef.current = isAutoReady;\n  clientUserRef.current = clientUser;\n  connectionRef.current = connection;\n  roomStateRef.current = roomState;\n  isCopyToClipboardRef.current = isCopyToClipboard;\n\n  const onJoinRoom = () => {\n    setLoading(true);\n\n    const username = usernameInput.trim();\n    const roomName = roomNameInput.trim();\n    const connection = io(\"wss://vnsync-silversin-zx3e8.ondigitalocean.app\", {\n      reconnection: true,\n      reconnectionDelay: 500,\n      reconnectionAttempts: 5,\n      autoConnect: false,\n    });\n\n    connection.io.on(\"reconnect_attempt\", () => {\n      console.log(connection.auth);\n      console.log(\"reconnect attempt\");\n    });\n\n    connection.io.on(\"reconnect_failed\", () => {\n      console.log(\"reconnect failed\");\n    });\n\n    connection.on(\"connect\", async () => {\n      console.log(\"connected\");\n\n      if (isInRoomRef.current) {\n        return;\n      }\n\n      const result = await emitEvent<string>(\n        connection,\n        \"joinRoom\",\n        username,\n        roomName\n      );\n\n      if (result.status !== \"ok\") {\n        setLastError(result.failMessage);\n        connection.disconnect();\n        return;\n      }\n\n      setInRoom(true);\n      setLoading(false);\n      setRoomName(roomName);\n      setLastError(\"\");\n    });\n\n    connection.on(\"disconnect\", (reason: string) => {\n      if (reason !== \"io server disconnect\") {\n        console.log(\"reconnecting...?\");\n\n        return;\n      }\n\n      setInRoom(false);\n      setLoading(false);\n      setRoomName(\"\");\n      setRoomState({\n        clipboard: [],\n        membersState: [],\n      });\n      setClientUser(null);\n      setConnection(null);\n    });\n\n    connection.on(\"roomStateChange\", (roomState: RoomState) => {\n      console.log(\"room state change\");\n\n      const clientUser =\n        roomState.membersState.find(\n          (roomUser) => roomUser.username === username\n        ) || null;\n\n      setRoomState(roomState);\n      setClientUser(clientUser);\n\n      if (\n        clientUser !== null &&\n        !clientUser.isReady &&\n        isAutoReadyRef.current &&\n        !isLoadingRef.current\n      ) {\n        onToggleReady();\n      }\n    });\n\n    connection.on(\"connect_error\", (reason) => {\n      console.log(reason);\n    });\n\n    connection.on(\"sessionId\", (sessionId: string) => {\n      console.log(sessionId);\n      connection.auth = {\n        sessionId,\n      };\n    });\n\n    connection.connect();\n\n    setConnection(connection);\n  };\n\n  const onToggleReady = async () => {\n    setLoading(true);\n\n    const connection = connectionRef.current;\n\n    if (!connection) {\n      throw new Error(\"Connection is not defined.\");\n    }\n\n    const result = await emitEvent<undefined>(connection, \"toggleReady\");\n\n    if (result.status !== \"ok\") {\n      setLastError(result.failMessage);\n      connection.disconnect();\n      return;\n    }\n\n    setLoading(false);\n  };\n\n  useEffect(() => {\n    let lastClipboardEntry: string | null = null;\n    let repeat = false;\n    const clipboardInterval = setInterval(async () => {\n      const clipboardEntry = roomStateRef.current?.clipboard[0] || \"\";\n\n      if (\n        lastClipboardEntry !== clipboardEntry &&\n        lastClipboardEntry !== null &&\n        isCopyToClipboardRef.current\n      ) {\n        try {\n          await navigator.clipboard.writeText(clipboardEntry);\n          repeat = false;\n        } catch {\n          repeat = true;\n        }\n      }\n\n      if (!repeat) {\n        lastClipboardEntry = clipboardEntry;\n      }\n    }, 100);\n\n    return () => clearInterval(clipboardInterval);\n  }, []);\n\n  return (\n    <>\n      <h2>VNSync v0.10</h2>\n      {lastError !== \"\" && <h3>Error: {lastError}</h3>}\n      <div>\n        {!isInRoom && (\n          <>\n            <label htmlFor=\"username\">Username:</label>\n            &nbsp;\n            <input\n              type=\"text\"\n              name=\"username\"\n              value={usernameInput}\n              onChange={(e) => setUsernameInput(e.target.value)}\n              disabled={isLoading}\n            />\n            <br />\n            <label htmlFor=\"roomName\">Room name:</label>\n            &nbsp;\n            <input\n              type=\"text\"\n              name=\"roomName\"\n              value={roomNameInput}\n              onChange={(e) => setRoomNameInput(e.target.value)}\n              disabled={isLoading}\n            />\n            <br />\n            <button disabled={isLoading} onClick={onJoinRoom}>\n              Join Room!\n            </button>\n          </>\n        )}\n        {isInRoom && (\n          <>\n            <h3>Room name: {roomName}</h3>\n            <ul>\n              {roomState.membersState.map((roomUser) => (\n                <li key={roomUser.username}>\n                  {roomUser.username} - {!roomUser.isReady && \"not\"} ready\n                </li>\n              ))}\n            </ul>\n            <button\n              onClick={onToggleReady}\n              disabled={isLoading || isAutoReady}\n              style={{\n                width: \"100%\",\n                height: \"300px\",\n              }}\n            >\n              {clientUser?.isReady ? \"Unready\" : \"Ready\"}\n            </button>\n            <hr />\n            <label>Auto ready: </label>\n            <input\n              type=\"checkbox\"\n              checked={isAutoReady}\n              onChange={(e) => {\n                if (\n                  clientUserRef.current !== null &&\n                  !clientUserRef.current?.isReady &&\n                  !isAutoReadyRef.current\n                ) {\n                  onToggleReady();\n                }\n\n                setAutoReady(e.target.checked);\n              }}\n            />\n            <br />\n            <label>\n              Automatically copy to clipboard (page has to be active for\n              clipboard updates to happen):\n            </label>\n            <input\n              type=\"checkbox\"\n              checked={isCopyToClipboard}\n              onChange={(e) => {\n                setCopyToClipboard(e.target.checked);\n              }}\n            />\n            <hr />\n            {roomState.clipboard.map((clipboardEntry, index) => (\n              <p>{clipboardEntry}</p>\n            ))}\n          </>\n        )}\n      </div>\n    </>\n  );\n};\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./index.css\";\nimport { App } from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}